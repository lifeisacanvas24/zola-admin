{% extends "base.html" %}

{% block content %}
<section class="section">
    <div class="container">
        <h1 class="title">Create New Template</h1>
        <form action="/add-new-post/" method="post" id="template-form" onsubmit="return validateForm()" novalidate>
            <!-- Template Name -->
            <div class="field">
                <label class="label" for="template_name">Template Name</label>
                <div class="control">
                    <input class="input" type="text" id="template_name" name="template_name" required>
                </div>
            </div>

            <!-- Category -->
            <div class="field">
                <label class="label" for="category">Category</label>
                <div class="control">
                    <div class="select">
                        <select id="category" name="category" required>
                            <option value="none">Please Choose Category</option>
                            <option value="lifestyle">Lifestyle</option>
                            <option value="reviews">Reviews</option>
                            <option value="technology">Technology</option>
                            <option value="random-thoughts">Random Thoughts</option>
                            <option value="stock-market">Stock Market</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Subcategory -->
            <div class="field">
                <label class="label" for="subcategory">Subcategory</label>
                <div class="control">
                    <div class="select">
                        <select id="subcategory" name="subcategory" required>
                            <option value="none">None</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Front Matter Section -->
            <h3 class="subtitle">Front Matter</h3>
            <div class="field">
                <label class="label" for="description">Description</label>
                <div class="control">
                    <input class="input" type="text" id="description" name="description" required>
                </div>
            </div>

            <div class="field">
                <label class="label" for="keywords">Keywords (comma-separated)</label>
                <div class="control">
                    <input class="input" type="text" id="keywords" name="keywords" required>
                </div>
            </div>

            <div class="field">
                <label class="label" for="date">Date</label>
                <div class="control">
                    <input class="input" type="date" id="date" name="date" required>
                </div>
            </div>

            <div class="field">
                <label class="checkbox">
                    <input type="checkbox" id="draft" name="draft"> Draft
                </label>
            </div>

            <!-- Open Graph Metadata Section -->
            <h3 class="subtitle">Open Graph Metadata</h3>
            <div class="field">
                <label class="label" for="og_title">OG Title</label>
                <div class="control">
                    <input class="input" type="text" id="og_title" name="og_title">
                    <label class="checkbox">
                        <input type="checkbox" class="copy-meta" data-target="og_title" id="copy_og_title"> Copy from Template Name
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label" for="og_description">OG Description</label>
                <div class="control">
                    <input class="input" type="text" id="og_description" name="og_description">
                    <label class="checkbox">
                        <input type="checkbox" class="copy-meta" data-target="og_description" id="copy_og_description"> Copy from Description
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label" for="og_image">OG Image Path</label>
                <div class="control">
                    <input class="input" type="text" id="og_image" name="og_image">
                    <label class="checkbox">
                        <input type="checkbox" class="copy-meta" data-target="og_image" id="copy_og_image"> Copy from Description
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label" for="og_url">OG URL</label>
                <div class="control">
                    <input class="input" type="text" id="og_url" name="og_url">
                    <label class="checkbox">
                        <input type="checkbox" class="copy-meta" data-target="og_url" id="copy_og_url"> Generate from Template Name and Category
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label" for="og_type">OG Type</label>
                <div class="control">
                    <input class="input" type="text" id="og_type" name="og_type" value="article">
                </div>
            </div>

            <!-- Additional Meta Tags Section -->
            <h3 class="subtitle">Additional Meta Tags</h3>
            <div class="field">
                <label class="label" for="author">Author Name</label>
                <div class="control">
                    <input class="input" type="text" id="author" name="author">
                </div>
            </div>

            <div class="field">
                <label class="label" for="viewport">Viewport</label>
                <div class="control">
                    <input class="input" type="text" id="viewport" name="viewport" value="width=device-width, initial-scale=1">
                </div>
            </div>

            <!-- JSON-LD Metadata Section -->
            <h3 class="subtitle">JSON-LD Metadata</h3>
            <div class="field">
                <label class="label" for="json_ld_name">JSON-LD Name</label>
                <div class="control">
                    <input class="input" type="text" id="json_ld_name" name="json_ld_name">
                    <label class="checkbox">
                        <input type="checkbox" class="copy-meta" data-target="json_ld_name" id="copy_json_ld_name"> Copy from OG Title
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label" for="json_ld_description">JSON-LD Description</label>
                <div class="control">
                    <input class="input" type="text" id="json_ld_description" name="json_ld_description">
                    <label class="checkbox">
                        <input type="checkbox" class="copy-meta" data-target="json_ld_description" id="copy_json_ld_description"> Copy from OG Description
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label" for="json_ld_url">JSON-LD URL</label>
                <div class="control">
                    <input class="input" type="text" id="json_ld_url" name="json_ld_url">
                    <label class="checkbox">
                        <input type="checkbox" class="copy-meta" data-target="json_ld_url" id="copy_json_ld_url"> Generate from OG URL
                    </label>
                </div>
            </div>

            <!-- Toast UI Editor for Content -->
            <div class="field">
                <label class="label">Content</label>
                <div class="control">
                    <div id="editor" style="min-height: 500px; border: 1px solid #ccc;"></div>
                </div>
            </div>

            <!-- Hidden Textarea for Editor Content -->
            <textarea name="content" id="editor-content" style="height: 0; opacity: 0;" required></textarea>

            <div class="field">
                <div class="control">
                    <button class="button is-primary" type="submit">Create Template</button>
                </div>
            </div>
        </form>
    </div>
</section>

<!-- Toast UI Editor Core -->
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

<!-- Toast UI Plugins -->
<script src="https://uicdn.toast.com/editor-plugin-code-syntax-highlight/latest/toastui-editor-plugin-code-syntax-highlight.min.js"></script>
<script src="https://uicdn.toast.com/editor-plugin-table-merged-cell/latest/toastui-editor-plugin-table-merged-cell.min.js"></script>
<script src="https://uicdn.toast.com/editor-plugin-uml/latest/toastui-editor-plugin-uml.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const Editor = toastui.Editor;

    // Initialize Toast UI Editor
    const editor = new Editor({
        el: document.querySelector('#editor'),
        height: '500px',
        initialEditType: 'markdown',
        previewStyle: 'vertical',
        plugins: [
            toastui.Editor.plugin.codeSyntaxHighlight,
            toastui.Editor.plugin.tableMergedCell,
            toastui.Editor.plugin.uml
        ],
        hook: {
            addImageBlobHook: (blob, callback) => {
                const url = URL.createObjectURL(blob);
                callback(url, blob.name);
            }
        }
    });

    // Handle form submission to copy editor content to textarea
    document.querySelector('#template-form').addEventListener('submit', function() {
        document.querySelector('#editor-content').value = editor.getMarkdown();
    });


    // Copy metadata functionality
       const copyCheckboxes = document.querySelectorAll('.copy-meta');
       copyCheckboxes.forEach(checkbox => {
           checkbox.addEventListener('change', function () {
               const targetId = this.getAttribute('data-target');
               const targetInput = document.getElementById(targetId);
               if (this.checked) {
                   switch (targetId) {
                       case 'og_title':
                           targetInput.value = document.getElementById('template_name').value; // Copy from Template Name
                           break;
                       case 'og_description':
                           targetInput.value = document.getElementById('description').value; // Copy from Description
                           break;
                       case 'og_image':
                           targetInput.value = document.getElementById('description').value; // Change this logic as needed
                           break;
                       case 'og_url':
                           // Generate URL based on template name and category
                           const category = document.getElementById('category').value;
                           const templateName = document.getElementById('template_name').value;
                           targetInput.value = `${templateName}-${category}`.replace(/\s+/g, '-').toLowerCase(); // Generates URL
                           break;
                       case 'json_ld_name':
                           targetInput.value = document.getElementById('og_title').value; // Copy from OG Title
                           break;
                       case 'json_ld_description':
                           targetInput.value = document.getElementById('og_description').value; // Copy from OG Description
                           break;
                       case 'json_ld_url':
                           targetInput.value = document.getElementById('og_url').value; // Copy from OG URL
                           break;
                   }
               } else {
                   targetInput.value = ''; // Clear the input if checkbox is unchecked
               }
           });
       });

       // Copy metadata function for URL generation
       const copyMetaData = (targetFieldId) => {
           const templateName = document.getElementById('template_name').value;
           const category = document.getElementById('category').value;
           const subcategory = document.getElementById('subcategory').value;
           let url = `http://lifeisacanvas24.github.io/blog/${category}`;

           // Include subcategory if selected
           if (subcategory && subcategory !== "none") {
               url += `/${subcategory}`;
           }

           // Append the generated slug from template name
           const slug = templateName.toLowerCase().replace(/\s+/g, '-');
           url += `/${slug}/`;

           const targetField = document.getElementById(targetFieldId);
           targetField.value = url; // Copying the generated URL to the target field
           targetField.disabled = true; // Disable the input field
       };

       // Event listeners for URL generation checkboxes
       document.querySelectorAll('.copy-meta').forEach(checkbox => {
           checkbox.addEventListener('change', (event) => {
               const targetFieldId = event.target.getAttribute('data-target');
               if (event.target.checked) {
                   if (targetFieldId === 'og_url' || targetFieldId === 'json_ld_url') {
                       copyMetaData(targetFieldId); // Generate URL for specific fields
                   } else {
                       const targetField = document.getElementById(targetFieldId);
                       targetField.disabled = true; // Disable the input field
                   }
               } else {
                   const targetField = document.getElementById(targetFieldId);
                   targetField.disabled = false; // Enable the input field if unchecked
               }
           });
       });

    // Subcategories Data
    const subcategories = {
        "lifestyle": ["Parenting", "Yoga", "Travel", "Food", "Fashion", "Minimalism", "Health and Wellness"],
        // "technology": ["Gadgets", "AI", "Programming"]
    };

    // Update subcategories based on selected category
    function updateSubcategories() {
        const category = document.getElementById('category').value;
        const subcategory = document.getElementById('subcategory');
        subcategory.innerHTML = '';  // Clear previous options

        if (subcategories[category]) {
            subcategories[category].forEach(sub => {
                const option = document.createElement('option');
                option.value = sub.toLowerCase().replace(/\s+/g, '-');
                option.textContent = sub;
                subcategory.appendChild(option);
            });
            subcategory.disabled = false;
        } else {
            const noneOption = document.createElement('option');
            noneOption.value = "none";
            noneOption.textContent = "None";
            subcategory.appendChild(noneOption);
            subcategory.disabled = true;
        }
    }

    // Event listener for category changes
    document.getElementById('category').addEventListener('change', updateSubcategories);
    updateSubcategories();  // Initialize subcategories on page load

});
</script>
{% endblock %}
